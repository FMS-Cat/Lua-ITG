<!doctype html>
<html class="no-js" lang="fr" dir="ltr">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=1026">
		<title>Lua for oITG / NotITG</title>
		<link rel="stylesheet" href="css/foundation.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700|Roboto:400,400i,700,700i" />
		<!--<script src="https://use.fontawesome.com/f74e84ee43.js"></script>-->
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
	</head>
	<body>
		<div id="page" class="row">
			<div id="sidebar" class="medium-7 large-6 columns">
				<div id="sidebar-content">
					<h2>Sections</h2>
					<nav>
						<ul>
							<li><a href="#basics">Basics of XML/Lua</a></li>
							<li><a href="#classes">Classes &amp; Methods</a></li>
							<li><a href="#enums">Enumerations</a></li>
							<li><a href="#globalfuncs">Global functions</a></li>
							<li><a href="#constants">Constants</a></li>
							<li><a href="#mods">Mods</a></li>
							<li><a href="#resources">Useful resources</a></li>
						</ul>
					</nav>

					<footer>
						<hr />
						<p>This website is not affiliated, sponsored, or endorsed by <a href="http://stepmania.com/" target="_blank">Stepmania</a>. NotITG is an <a href="http://openitg.gr-p.com/" target="_blank">OpenITG</a> modification by <a href="https://www.youtube.com/c/taro4012itg">TaroNuke</a>. Thanks to him for his help !</p>
						<p>&copy; HeySora &middot; This website is provided "as is" without warranty of any kind. This website is licensed under the GNU AGPL-3 license. <a href="https://github.com/HeySora/Lua-ITG" target="_blank">Github</a>.</p>
					</footer>
				</div>
			</div>
			<div id="main" class="columns">
				<div id="main-content">
					<header>
						<h1>Lua API for OpenITG / NotITG</h1>
					</header>

					<section id="basics">

						<h3>Basics of XML/Lua</h3>

						<h4 id="Basics_Intro">Introduction</h4>
						<p>The Lua API is supported in OpenITG / NotITG through XML. With this, you can easily create "modded simfiles", by manipulating elements, adding images, and much more.</p>
						<p>"Elements" are called "Actors". An Actor can be a rectangle, a picture, some text, or even 3D objects, the player, or the screen itself ! In your code, you will manipulate existing Actors and also create some. You can control <em>almost</em> everything in lua, but NotITG provides even more tools and some new Actors to make beautiful simfiles !</p>

						<hr />


						<h4 id="Basics_GettingStarted">Getting started</h4>

						<p>First, <strong class="rainbow">DO NOT CODE WITH WINDOWS NOTEPAD !</strong> This software doesn't help you at all to code something. You can't indent, the text isn't colorized, etc. You should use a better text editor. I'd personally recommend <a href="https://www.sublimetext.com/" target="_blank">Sublime Text</a> because there are really useful features and shortcuts, but there are also other softwares, such as <a href="https://notepad-plus-plus.org/" target="_blank">Notepad++</a>. If you love command-line prompts, you can also use vim or emacs !</p>

						<p>Let's assume your simfile looks like that :</p>

						<img src="https://i.heysora.net/QlUwta.png" alt="" />

						<p>You probably don't have the "lua" folder. Just create it, and create an empty text document called "default.xml".</p>

						<p>To include an XML file in the foreground <em class="g">(a file that will do mods, and add elements at front of playfields)</em>, replace your <span class="mono">#FGCHANGES</span> line by :</p>

						<div class="example nohighlight">
							#FGCHANGES:0.000=lua=1.000=0=0=1=====;
						</div>

						<p>To make short, this line will include the <strong>lua</strong>/default.xml file at the very beginning of the song. Ignore the other arguments for now.</p>

						<p>To add one, but in the background <em class="g">(a file that won't do any mod, but that will add some elements in the background)</em>, replace your <span class="mono">#BGCHANGES</span> line with this one :</p>

						<div class="example nohighlight">
							#BGCHANGES:0.000=bg=1.000=0=0=1=====;
						</div>

						<p>Here, the file located in <strong>bg</strong>/default.xml will be loaded.</p>

						<p>The XML file should look like this :</p>

						<div class="example xml">
							&lt;ActorFrame&gt;&lt;children&gt;<br />
							<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&lt;Layer<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type="Quad"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InitCommand="hidden,1;sleep,9999"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;/&gt;<br />
							<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&lt;!-- You will add elements there --&gt;<br />
							<br />
							&lt;/children&gt;&lt;/ActorFrame&gt;
						</div>

						<p>If you already did XML or any SGML-based language (for example, HTML), you will be familiar with this syntax.</p>

						<p>Let's explain this code :</p>

						<ul>
							<li>A XML file must "give" only one Actor to the game. How could we do that ? An ActorFrame is an Actor that contains Actors. Here we're defining an ActorFrame by using the <span>"ActorFrame"</span> tag.</li>
							<li>The <span>"children"</span> tag is needed for Actors that contains other Actors.</li>
							<li>Here, we have an Actor of type Quad (a rectangle). We will hide it because we don't need to show it to the player, and we will apply a "sleep" effect for 9999 seconds. Why ? Because the game will stop any XML file that isn't doing anything. Adding this Actor fixes this behavior because the file will always do something. We are using a Quad here because it's the lightest Actor (we don't need a picture or a text).</li>
							<li>Here, we're just closing the tags we opened before.</li>
						</ul>

						<p>Now, you know how to add Actors to your file, but... We aren't doing any Lua until now. We will put our main code into... An Actor ! Now our file looks like this :</p>
						
						<div class="example xml">
							&lt;ActorFrame&gt;&lt;children&gt;<br />
							<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&lt;Layer<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type="Quad"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InitCommand="hidden,1;sleep,9999"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;/&gt;<br />
							<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&lt;Layer<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Type="Quad"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;InitCommand="hidden,1"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;OnCommand="%function(self)<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;SCREENMAN:SystemMessage('Hello world !');<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;/&gt;<br />
							<br />
							&lt;/children&gt;&lt;/ActorFrame&gt;
						</div>
						
						<p>Again, let's explain what we added :</p>

						<ul>
							<li>We added another Quad in our ActorFrame, also hidden.</li>
							<li>Inside the <span class="mono">OnCommand</span>, there is some lua ! We're actually just showing "Hello world !" to the screen.</li>
						</ul>

						<p>Let's talk now quickly about lua : Lua is the scripting language used in OpenITG / NotITG. It allows us to manipulate elements.</p>

						<p>Let's add a little picture in the game, for example, <a href="img/itg.png" target="_blank">the OpenITG icon</a>. Download this icon, and put it in the lua folder.</p>

						<p>Now to show it in game, we will add this to our ActorFrame (I won't re-write the entire code, you know how to add elements inside the ActorFrame :P) :</p>
						
						<div class="example xml">
							&lt;Layer<br />
							&nbsp;&nbsp;&nbsp;&nbsp;File="itg.png"<br />
							/&gt;
						</div>

						<p>Yaay, now we have an icon, but it is located in the top left corner. Let's center it now :</p>

						<div class="example xml">
							&lt;Layer<br />
							&nbsp;&nbsp;&nbsp;&nbsp;File="itg.png"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;InitCommand="%function(self)<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self:x(SCREEN_CENTER_X);<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self:y(SCREEN_CENTER_Y);<br />
							&nbsp;&nbsp;&nbsp;&nbsp;end"<br />
							/&gt;
						</div>

						<p>Yay, it is centered now ! Let's explain what happened :</p>

						<ul>
							<li><span class="mono">self</span> is the keyword to target the current Actor. Here it targets the picture.</li>
							<li>We're telling <span class="mono">self</span> to move in the horizontal (X) axis to the center of the screen. We're doing the same for the vertical (Y) axis.</li>
							<li><span class="mono">SCREEN_CENTER_X</span> and <span class="mono">SCREEN_CENTER_Y</span> are "constants". They represents here a number that we will give to the <a class="code method-link" href="#Class_Actor_x"><img src="img/itg.png">self:x()</a> method. If you're curious, <span class="mono">SCREEN_CENTER_X</span> equals "320" and <span class="mono">SCREEN_CENTER_Y</span> equals "240", because the OpenITG screen is based on the 640x480 resolution.</li>
						</ul>

						<p>Let's now talk about commands now.</p>

						<ul>
							<li><span class="mono">InitCommand</span> is a command that will be executed as soon as possible. It is useful to manipulate an Actor (for example, moving it and resizing it), but please avoid to access to other elements, because the command is executed so early that other elements may not be accessible (And will crash the game with an "Access Violation" error). <strong>They don't work in background (file imported with <span class="mono">#BGCHANGES</span>) !</strong></p></li>
							<li><span class="mono">OnCommand</span> is a command that will be executed when everything will be ready. You can do everything there, without limitations.</li>
						</ul>

						<p>Let's now try to draw a green rectangle of 300x200 pixels !</p>

						<div class="example xml">
							&lt;Layer<br />
							&nbsp;&nbsp;&nbsp;&nbsp;Type="Quad"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;InitCommand="%function(self)<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self:x(SCREEN_CENTER_X); -- Centers horizontally the rectangle<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self:y(SCREEN_CENTER_Y); -- Centers vertically the rectangle<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self:zoomto(300, 200); -- Defines its size to 300x200<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self:diffuse(0, 1, 0, 1); -- Colors it in green (0% red, 100% green, 0% blue, 100% opaque)<br />
							&nbsp;&nbsp;&nbsp;&nbsp;end"<br />
							/&gt;
						</div>

						<p>Easy, right ? If you have questions regarding these new methods, see <a class="code method-link" href="#Class_Actor_zoomto"><img src="img/itg.png">Actor.zoomto()</a> and <a class="code method-link" href="#Class_Actor_diffuse"><img src="img/itg.png">Actor.diffuse()</a> <em>(Don't forget that the main purpose of this webpage was to provide <strong>every</strong> method available :P)</em>.</p>

						<p>To learn further with video guides, watch <a href="https://www.youtube.com/playlist?list=PL59am1u_lAuPeoQkCfujwIsbddImZNvXe" target="_blank">the tutorial videos</a> made by <a href="https://www.youtube.com/user/Puurokulho" target="_blank">Puurokulho</a> ! To learn Lua, read the official <a href="https://www.lua.org/manual/5.0/" target="_blank">Lua documentation.</a> (Keep in mind that OpenITG and NotITG are using <strong>Lua 5.0</strong>). If you're "good" in lua modding, and want to learn further, watch <a href="https://www.twitch.tv/windeu/profile/highlights" target="_blank">these advanced tutorials</a> by <a href="https://www.youtube.com/user/WinDEU" target="_blank">WinDEU</a> !</p>

						<p>WIP.</p>

						<hr />


						<h4 id="Basics_ActorCommands">Actor Commands</h4>

						<p>WIP.</p>

						<hr />


						<h4 id="Basics_Messages">Messages</h4>

						<p>WIP.</p>

						<hr />


						<h4 id="Basics_Tweens">Tweens</h4>

						<p>Tweens are a way to smoothly manipulate elements. For example, let's do :</p>

						<div class="example lua">
							self:linear(1);<br />
							self:zoom(2);
						</div>

						<p>This will <em>linearly</em> zooms the Actor to be 2 times bigger than before, within one second.</p>
						<p>Every function that is called after a tween will be tweened. This way, you can tween multiple operations, for example :</p>

						<div class="example lua">
							self:linear(1);<br />
							self:zoom(2); -- Will go from 1 to 2 in one second.<br />
							self:addx(100); -- Will move 100px to the right in one second.<br />
							self:addy(50); -- Will move 50px to the bottom in one second.<br />
							self:rotationz(30); -- Will rotate from 30 degrees in one second.
						</div>

						<p>If you want to tween only specific functions, but not some others, you can use <a class="code method-link" href="#Class_Actor_sleep"><img src="img/itg.png">Actor.sleep()</a> this way :</p>

						<div class="example lua">
							self:linear(1);<br />
							self:zoom(2); -- Will go from 1 to 2 in one second.<br />
							self:addx(100); -- Will move 100px to the right in one second.<br />
							self:addy(50); -- Will move 50px to the bottom in one second.<br />
							self:sleep(0); -- "Resets" the linear(1) for the next commands.<br />
							self:rotationz(30); -- Will rotate from 30 degrees *instantly*.
						</div>

						<p>This will act like before, but when the tween will be finished, a rotation will be instantly applied.</p>

						<p>There are 7 tweens available for now :</p>

						<ul>
							<li><a class="code method-link" href="#Class_Actor_linear"><img src="img/itg.png">Actor.linear()</a>, the simplest. It will tween linearly.</li>
							<li><a class="code method-link" href="#Class_Actor_accelerate"><img src="img/itg.png">Actor.accelerate()</a> will tween slowly at the beginning, and the transition will become faster until the end.</li>
							<li><a class="code method-link" href="#Class_Actor_decelerate"><img src="img/itg.png">Actor.decelerate()</a> will tween quickly at the beginning, and the transition will become slower until the end.</li>
							<li><a class="code method-link" href="#Class_Actor_spring"><img src="img/itg.png">Actor.spring()</a> will tween slowly, will become faster until the tween will be after the end, and come back to the expected end (for example, if you did <span class="mono">self:addx(100)</span>, it will go to ~110, and come back to 100).</li>
							<li><a class="code method-link" href="#Class_Actor_bouncebegin"><img src="img/itg.png">Actor.bouncebegin()</a> will bounce at the beginning, before going to the end.</li>
							<li><a class="code method-link" href="#Class_Actor_bounceend"><img src="img/itg.png">Actor.bounceend()</a> will bounce at the end.</li>
							<li><a class="code method-link" href="#Class_Actor_sleep"><img src="img/itg.png">Actor.sleep()</a>. Yes, this is a tween ! It just waits before applying instantly the commands.</li>
						</ul>

						<hr />


						<h4 id="Basics_ActorEffects">Actor Effects</h4>

						<p>An Actor Effect is an Effect that is modifying on its own the position, the size, or the colors of a specific Actor.</p>

						<hr />


						<h4 id="Basics_Aux">Aux variables</h4>

						<p>An aux value is a variable of type number (a float to be exact), that can be tweened. You can, for example, change the value from 0 to 360 in one second. This way, if you check this aux value at 0.5 seconds, it will be 180. You can read this number from everywhere in your code. It's usually used into mathematic formulas.</p>

						<p>To ease our job, we will use a separate Actor (a hidden Quad, as usual). It will be used to set the aux values. It will look like this :</p>

						<div class="example xml">
							&lt;Layer<br />
							&nbsp;&nbsp;&nbsp;&nbsp;Type="Quad"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;InitCommand="%function(self)<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self:hidden(1);<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;auxvar = self; -- The 'aux' variable will target this Actor.<br />
							&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self:aux(0); -- The 'default value' of the aux value will be 0.<br />
							&nbsp;&nbsp;&nbsp;&nbsp;end"<br />
							&nbsp;&nbsp;&nbsp;&nbsp;RotateMessageCommand="finishtweening;linear,1;aux,360"<br />
							/&gt;
						</div>

						<ul>
							<li>First, as usual, we hide the quad.</li>
							<li>Then, we set the 'auxvar' variable to self. It allows us to access this Actor from another location, to get the current aux value.</li>
							<li>And we set the default value of the aux var to 0. <a class="code method-link" href="#Class_Actor_aux"><img src="img/itg.png">Actor.aux()</a> is used to set the aux value.</li>
							<li>We defined a MessageCommand that will finish the current and queued tweens on this Actor, and set the aux value to 360 within one second.</li>
						</ul>

						<p>For example, if you want to move a Quad like a circle shape <em>(assuming the <span class="mono">square</span> variable represents an Actor)</em>, you'll do something in an UpdateCommand like :</p>

						<div class="example lua">
							square:x(SCREEN_CENTER_X + math.sin(auxvar:getaux())*200);<br />
							square:y(SCREEN_CENTER_Y + math.cos(auxvar:getaux())*-200);
						</div>

						<p>Here, we use <a class="code method-link" href="#Class_Actor_getaux"><img src="img/itg.png">Actor.getaux()</a> to get the current aux value. Let's imagine we call the Rotate Message at the second 2 :</p>

						<ul>
							<li>If we do getaux() at the second 2, it will return 0.</li>
							<li>If we do getaux() at the second 3, it will return 360.</li>
							<li>But if we do getaux() at the second 2.5, it will return 180 !</li>
						</ul>

						<p>Using <a class="code method-link" href="#Class_Actor_aux"><img src="img/itg.png">Actor.aux()</a> and <a class="code method-link" href="#Class_Actor_getaux"><img src="img/itg.png">Actor.getaux()</a> is not the only solution ! You could also have additional "aux" values by using <a class="code method-link" href="#Class_Actor_x"><img src="img/itg.png">Actor.x()</a> and <a class="code method-link" href="#Class_Actor_GetX"><img src="img/itg.png">Actor.GetX()</a>, <a class="code method-link" href="#Class_Actor_y"><img src="img/itg.png">Actor.y()</a> and <a class="code method-link" href="#Class_Actor_GetY"><img src="img/itg.png">Actor.GetY()</a>, or even <a class="code method-link" href="#Class_Actor_z"><img src="img/itg.png">Actor.z()</a> and <a class="code method-link" href="#Class_Actor_GetZ"><img src="img/itg.png">Actor.GetZ()</a> on the same Actor ! Coordinates have the benefit of not needing a default value. Of course, you can have multiple hidden Quads that you will use to have aux values. Just don't forget of editing the <span class="mono">auxvar = self;</span> line to something like <span class="mono">auxvar_2</span> !</p>

						<hr />


						<h4 id="Basics_BlendModes">Blend Modes</h4>

						<p>WIP.</p>

					</section>
					<section id="classes">
					
						<h3>Classes &amp; Methods</h3>

					</section>
					<section id="enums">
					
						<h3>Enumerations</h3>

					</section>
					<section id="globalfuncs">
					
						<h3>Global functions</h3>

						<p>WIP.</p>

					</section>
					<section id="constants">
					
						<h3>Constants</h3>

						<p>WIP.</p>

					</section>
					<section id="mods">
					
						<h3>Mods</h3>

						<p>
							WIP.
							<a href="/itg.txt" target="_blank"><img src="img/itg.png" />OpenITG Mods</a>
							<a href="/notitg.txt" target="_blank"><img src="img/notitg.png" />NotITG + OpenITG Mods</a>
						</p>

					</section>
					<section id="resources">
					
						<h3>Useful resources</h3>

						<ul>
							<li><a href="https://www.youtube.com/playlist?list=PL59am1u_lAuPeoQkCfujwIsbddImZNvXe" target="_blank">Beginner video tutorials</a> by <a href="https://www.youtube.com/user/Puurokulho" target="_blank">Puurokulho</a></li>
							<li><a href="https://www.twitch.tv/windeu/profile/highlights" target="_blank">Advanced video tutorials</a> by <a href="https://www.youtube.com/user/WinDEU" target="_blank">WinDEU</a></li>
							<li><a href="https://www.lua.org/manual/5.0/" target="_blank">Lua 5.0 documentation</a></li>
							<li><a href="http://jousway.co.uk/wiki/" target="_blank">Jousway's Wiki (WIP)</a>
						</ul>

					</section>
				</div>
			</div>
		</div>

		<!-- jQuery 3.1.1 -->
		<script src="https://code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8= sha384-3ceskX3iaEnIogmQchP8opvBy3Mi7Ce34nWjpBIwVTHfGYWQS9jwHDVRnpKKHJg7 sha512-U6K1YLIFUWcvuw5ucmMtT9HH4t0uz3M366qrF5y4vnyH6dgDzndlcGvH/Lz5k8NFh80SN95aJ5rqGZEdaQZ7ZQ==" crossorigin="anonymous"></script>

		<!-- jQuery UI 1.12.1 -->
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js" integrity="sha256-VazP97ZCwtekAsvgPBSUwPFKdrwD3unUfSGVYrahUqU= sha384-Dziy8F2VlJQLMShA6FHWNul/veM9bCkRUaLqr199K94ntO5QUrLJBEbYegdSkkqX sha512-4DaiBX8rsgOoBSNLceQ/IixDF+uUDV0hJrQX/MJ9RwJZCDqbEp0EjIQodGxszPtTpwlenJznR2jkgDWqj4Hs+A==" crossorigin="anonymous"></script>

		<script src="js/vendor/what-input.js"></script>
		<script src="js/vendor/foundation.min.js"></script>
		<script src="js/main.js"></script>
	</body>
</html>
